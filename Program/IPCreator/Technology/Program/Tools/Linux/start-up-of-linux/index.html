<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon.ico">
  <link rel="mask-icon" href="/img/apple-touch-icon.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hazyman.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="wjlkoorey  在博文“Linux系统启动过程分析”中我们了解了linux系统的启动流程，今天我们就来手动一步一步从头来构建一个最小的linux系统，然后用模拟器将其加载起来。常见的模拟器有Qemu、Bochs、VMWare、VPC、Virtual Box和Xen等，以及特殊的模拟UML(User-Mode-Linux)，这里我们选择用VMWare。">
<meta name="keywords" content="Basic Concept,Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="Build your own Linux System">
<meta property="og:url" content="https://hazyman.com/Program/IPCreator/Technology/Program/Tools/Linux/start-up-of-linux/index.html">
<meta property="og:site_name" content="生命之旅">
<meta property="og:description" content="wjlkoorey  在博文“Linux系统启动过程分析”中我们了解了linux系统的启动流程，今天我们就来手动一步一步从头来构建一个最小的linux系统，然后用模拟器将其加载起来。常见的模拟器有Qemu、Bochs、VMWare、VPC、Virtual Box和Xen等，以及特殊的模拟UML(User-Mode-Linux)，这里我们选择用VMWare。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-03-27T10:00:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Build your own Linux System">
<meta name="twitter:description" content="wjlkoorey  在博文“Linux系统启动过程分析”中我们了解了linux系统的启动流程，今天我们就来手动一步一步从头来构建一个最小的linux系统，然后用模拟器将其加载起来。常见的模拟器有Qemu、Bochs、VMWare、VPC、Virtual Box和Xen等，以及特殊的模拟UML(User-Mode-Linux)，这里我们选择用VMWare。">

<link rel="canonical" href="https://hazyman.com/Program/IPCreator/Technology/Program/Tools/Linux/start-up-of-linux/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Build your own Linux System | 生命之旅</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="生命之旅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">生命之旅</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">常识、专业和价值。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/IPCreator1833" class="github-corner" title="IPCreator" aria-label="IPCreator" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hazyman.com/Program/IPCreator/Technology/Program/Tools/Linux/start-up-of-linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/content/Kick-Off.jpg">
      <meta itemprop="name" content="IPCreator">
      <meta itemprop="description" content="Life is a journey.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="生命之旅">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Build your own Linux System
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/Program/IPCreator/Technology/Program/Tools/Linux/start-up-of-linux/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Program/IPCreator/Technology/Program/Tools/Linux/start-up-of-linux/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><a href="http://blog.chinaunix.net/uid-23069658-id-3343885.html" target="_blank" rel="noopener">wjlkoorey</a></p>
<p><img data-src="http://blog.chinaunix.net/attachment/201303/23/23069658_1364022276448d.gif" alt></p>
<p>在博文“<a href="http://blog.chinaunix.net/uid-23069658-id-3142047.html" target="_blank" rel="noopener">Linux系统启动过程分析</a>”中我们了解了linux系统的启动流程，今天我们就来手动一步一步从头来构建一个最小的linux系统，然后用模拟器将其加载起来。常见的模拟器有Qemu、Bochs、VMWare、VPC、Virtual Box和Xen等，以及特殊的模拟UML(User-Mode-Linux)，这里我们选择用VMWare。</p>
   <a id="more"></a>
<pre><code>我们制作的Linux系统有shell功能，支持Web Server，telnet等服务，以及ifconfig，vi等常见工具。准备工作：
在http://www.kernel.org 下载内核源代码 linux-2.6.21.tar.bz2；
在http://www.busybox.org 下载busybox源码 busybox-1.14.4.tar.bz2。
在本地新建一个目录，例如/home/DIY，当然你可以随便选择，然后将下载的内核源码和busybox源码包拷贝到/home/DIY目录下；
</code></pre><p><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347285972uzot.jpg" alt><br>    A)、构造根文件系统<br>    我们都知道标准的发行版linux其目录结构一般是如下这个样子：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_13472860152b32.jpg" alt><br>    我们制作的linux运行起来之后当然也应该有个类似的目录结构。这里我们只选择一些必须的目录，因为我们构建的是“最小”的Linux系统。<br>    在/home/DIY目录下依次执行如下命令：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347286127dDXv.jpg" alt><br>    在rootfs/etc目录下分别建立如下各个文件group、inittab、profile、protocols、<br>rcS和services：<br>点击(此处)折叠或打开</p>
<p>###################### /etc/group ###################### from here<br>root:x:0:<br>ftp:x:800:<br>nogroup:x:65534:</p>
<p>######################/etc/inittab ###################### from here<br>::sysinit:/etc/rcS<br>tty1::askfirst:-/bin/sh –login<br>tty2::askfirst:-/bin/sh –login<br>tty3::askfirst:-/bin/sh –login</p>
<p>######################/etc/profile ###################### from here</p>
<p>#!/bin/sh</p>
<p>cat &lt;&lt;EOF</p>
<p>Welcome to  DIY</p>
<p>EOF<br>export PATH=/bin:/sbin:/usr/bin:/usr/sbin</p>
<p>######################/etc/protocols ###################### from here</p>
<h1 id="Internet-IP-protocols"><a href="#Internet-IP-protocols" class="headerlink" title="Internet (IP) protocols"></a>Internet (IP) protocols</h1><p>#<br>ip    0    IP<br>icmp    1    ICMP<br>igmp    2    IGMP<br>ggp    3    GGP<br>ipencap    4    IP-ENCAP<br>st    5    ST<br>tcp    6    TCP<br>egp    8    EGP<br>igp    9    IGP<br>pup    12    PUP<br>udp    17    UDP<br>hmp    20    HMP<br>xns-idp    22    XNS-IDP<br>rdp    27    RDP<br>iso-tp4    29    ISO-TP4<br>xtp    36    XTP<br>ddp    37    DDP<br>idpr-cmtp 38    IDPR-CMTP<br>idrp    45    IDRP<br>rsvp    46    RSVP<br>gre    47    GRE<br>esp    50    IPSEC-ESP<br>ah    51    IPSEC-AH<br>skip    57    SKIP<br>rspf    73    RSPF CPHB<br>vmtp    81    VMTP<br>eigrp    88    EIGRP<br>ospf    89    OSPFIGP<br>ax.25    93    AX.25<br>ipip    94    IPIP<br>etherip    97    ETHERIP<br>encap    98    ENCAP<br>pim    103    PIM<br>ipcomp    108    IPCOMP<br>vrrp    112    VRRP<br>l2tp    115    L2TP<br>isis    124    ISIS<br>sctp    132    SCTP<br>fc    133    FC</p>
<p>######################/etc/rcS ###################### from here</p>
<p>#!/bin/sh</p>
<p>export PATH=/bin:/sbin:/usr/bin:/usr/sbin<br>mount -t proc none /proc<br>mount -t sysfs none /sys<br>mount -t tmpfs tmpfs /dev -o size=512K,mode=0755<br>echo DIY &gt; /proc/sys/kernel/hostname</p>
<p>mkdir -p /var/run /var/log /var/lock /var/state \<br>         /var/tmp /var/mnt /dev/pts /dev/shm<br>mount devpts /dev/pts -t devpts</p>
<p>echo /bin/mdev &gt; /proc/sys/kernel/hotplug<br>mdev -s</p>
<p>ifconfig lo 127.0.0.1 up<br>ifconfig eth0 192.168.1.1 netmask 255.255.255.0 up</p>
<p>telnetd -l /bin/sh<br>httpd -h /www</p>
<p>###################/etc/services ################# from here<br>ssh    22/tcp<br>ssh    22/udp<br>telnet    23/tcp<br>telnet    23/udp<br>http    80/tcp    www www-http<br>http    80/udp    www www-http<br>login    513/tcp<br>shell    514/tcp    cmd<br>    再在rootfs/www目录下建立一个index.html文件，内容如下：<br>点击(此处)折叠或打开</p>
<p></p><h1>Success!</h1><p></p>
<p></p><p>Welcome to DIY linux!</p><br>    最后rootfs目录的组织结构如下：<p></p>
<p><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347286131jGjr.jpg" alt><br>    其他的命令行工具由接下来的busybox生成。<br>    B)、编译busybox<br>    在Linux系统中常用的工具，如 bash、grep命令、sed 命令、telnetd等，这里为了方便省事，我就用busybox来代替了。现在的busybox拥有非常多的工具，真正成为一个“Busy”的box。后面的例子将尝试只使用 busybox来充当所有应用层所需要的工具集。包括Shell，网络配置，web服务器，telnet等。而busybox也由此得到一个称号“嵌入式世界的瑞士军刀”。</p>
<p><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347286135MHsQ.jpg" alt><br>    将修改后的“ <a href="http://blog.chinaunix.net/attachment/attach/23/06/96/5823069658e50981fdbbfec6c9bf052e2250a0fba1.txt" target="_blank" rel="noopener">busybox.config.txt</a>   ”复制到busybox-1.14.4目录下重命名为“.config”，注意文件名前面的点“.”绝对不能省略。</p>
<p><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347287650blYG.jpg" alt><br>    之后弹出如下界面：</p>
<p><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347287704pnSv.jpg" alt><br>    在配置界面下，我们依次选择：Busybox Settings =&gt; Build Options 然后选中(按空格键)，这里我们将编译生成静态库的busybox，如下图中所示选项：</p>
<p><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347287709zv94.jpg" alt><br>    配置busybox的安装目录，依次选择：Busybox Settings =&gt; Installation Options ，如下：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_13472877465653.jpg" alt><br>    保存配置后执行编译命令make：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347287779joj0.jpg" alt><br>    编译完成后执行make install：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347287785pc6p.jpg" alt><br>    这样我们编译的busybox工具就安装到前面我们创建的rootfs目录中了，此时rootfs目录下的组织结构就变成了如下这个样子：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347287856Nm1K.jpg" alt><br>    不管是bin，sbin，usr/bin还是usr/sbin目录下的命令都是到/bin/busybox应用程序的软连接。目前rootfs这个目录结构和我们常见的linux发行版的目录结构还是有些差异，所以我们继续往rootfs中增加dev，proc，tmp，var，lib，root和sys目录：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347287895zW4p.jpg" alt><br>    这样子就更像一个“标准”linux发行版的样子了。接下来我们来制作一个ramdisk的初始化文件，名为initrd。Linux内置支持以RAM磁盘的形式来启动。关于Linux系统的启动流程请参见博文“Linux系统启动过程分析”里的详细描述。<br>    C)、制作initrd文件<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347288002U90O.jpg" alt><br>    D)、编译Linux内核源码<br>    解压内核源码，然后将我修改后的内核配置文件“ linux.config.txt   ”拷贝到linux-2.6.21目录下，重命名为“.config”，如下：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347288136iSA4.jpg" alt><br>    执行make menuconfig可以查看哪些配置项已经被选上：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347288142C8Gn.jpg" alt><br>    执行make命令开始编译内核：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347288152gMkw.jpg" alt><br>    我们提供的内核配置文件linux.conf将模块已经静态编译到内核中去了，这样就会造成内核比较大，如果是采用动态加载模块的话，需要将所有模块安装到前面制作的ramdisk里。编译好的内核镜像，一般位于：<br>•    对于x86平台，压缩后的核心是 arch/x86/boot/bzImage；<br>•    对于MIPS平台，压缩后的核心是 arch/powerpc/boot/zImage；<br>•    对于arm平台，压缩后的核心是 arch/arm/boot/zImage<br>……<br>E)、用VMWare加载内核<br>将arch/x86/boot/bzImage和/home/DIY/initrd文件拷贝到linux系统的/boot目录下，然后修改/boot/grub/menu.lst，在其中添加如下一项：<br>点击(此处)折叠或打开<br>title DIY Your OS<br>   root (hd0,0)<br>   kernel /bzImage rw root=/dev/ram rootfs_size=8M<br>   initrd /initrd<br>   PS：因为我们制作的initrd文件大小就是8M，所以rootfs_size=8M。<br>    重启VMware，在启动界面我们自己built的linux系统：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_13472882411HVV.jpg" alt><br>    启动后效果如下：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347288291YEn1.jpg" alt><br>    我们可以看到eth0接口已经up了，其IP地址默认为192.168.1.1，因为我虚拟机的IP地址池是192.168.6.*网段的，所以手动将eth0的接口IP设置为192.168.6.135：<br><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347288378iAFa.jpg" alt><br>然后通过web和telnet访问我们自己做的系统，最终的访问结果如下：</p>
<p><img data-src="http://blog.chinaunix.net/attachment/201209/10/23069658_1347288420b44Z.jpg" alt></p>
<h3 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h3><p>通过今天的学习相信大家对Linux系统的运行原理和启动流程的认识又上了一个新的台阶，更重要的是学会了如何手动构建一个“最小”的Linux“发行版”系统。那么，现在回过头来再看那些商业版的Linux系统，其实本质和我们今天做工作的差不多，所以，如果有条件我们也可以发行一个自己的系统了:)。</p>
<h2 id="Linux系统启动过程分析"><a href="#Linux系统启动过程分析" class="headerlink" title="Linux系统启动过程分析 "></a><a href="http://blog.chinaunix.net/uid-23069658-id-3142047.html" target="_blank" rel="noopener">Linux系统启动过程分析 </a></h2><p>经过对Linux系统有了一定了解和熟悉后，想对其更深层次的东西做进一步探究。这当中就包括系统的启动流程、文件系统的组成结构、基于动态库和静态库的程序在执行时的异同、协议栈的架构和原理、驱动程序的机制等等。<br>       本人在综合了现有网上大家智慧的基础上，结合对2.6.32的内核代码的研读，基于CentOS 6.0系统对Linux的启动流程做了些分析。由于才疏学浅，知识所限，有些地方分析不妥之处还请各位高手不吝赐教。<br>        OK，我们言归正传。对于一台安装了Linux系统的主机来说，当用户按下开机按钮时，一共要经历以下几个过程，如图：<br><img data-src="http://blog.chinaunix.net/attachment/201303/23/23069658_1364022276448d.gif" alt></p>
<pre><code>其中，每个过程都执行了自己该做的初始化部分的事情，有些过程又可分为好几个子过程。接下来，我们就对每个阶段做一个详细分析和讲解。
</code></pre><p>BIOS自检</p>
<pre><code>稍有计算机基础的人都应该听过BIOS(Basic Input / Output System)，又称基本输入输出系统，可以视为是一个永久地记录在ROM中的一个软件，是操作系统输入输出管理系统的一部分。早期的BIOS芯片确实是&quot;只读&quot;的，里面的内容是用一种烧录器写入的，一旦写入就不能更改，除非更换芯片。现在的主机板都使用一种叫Flash EPROM的芯片来存储系统BIOS，里面的内容可通过使用主板厂商提供的擦写程序擦除后重新写入，这样就给用户升级BIOS提供了极大的方便。
BIOS的功能由两部分组成，分别是POST码和Runtime服务。POST阶段完成后它将从存储器中被清除，而Runtime服务会被一直保留，用于目标操作系统的启动。BIOS两个阶段所做的详细工作如下：
 步骤1：上电自检POST(Power-on self test)，主要负责检测系统外围关键设备（如：CPU、内存、显卡、I/O、键盘鼠标等）是否正常。例如，最常见的是内存松动的情况，BIOS自检阶段会报错，系统就无法启动起来；
 步骤2：步骤1成功后，便会执行一段小程序用来枚举本地设备并对其初始化。这一步主要是根据我们在BIOS中设置的系统启动顺序来搜索用于启动系统的驱动器，如硬盘、光盘、U盘、软盘和网络等。我们以硬盘启动为例，BIOS此时去读取硬盘驱动器的第一个扇区(MBR，512字节)，然后执行里面的代码。实际上这里BIOS并不关心启动设备第一个扇区中是什么内容，它只是负责读取该扇区内容、并执行。
</code></pre><p>至此，BIOS的任务就完成了，此后将系统启动的控制权移交到MBR部分的代码。<br>        PS: 在个人电脑中，Linux的启动是从0xFFFF0地址开始的。</p>
<p>系统引导</p>
<pre><code>我们首先来了解一下MBR，它是Master Boot Record的缩写。硬盘的0柱面、0磁头、1扇区称为主引导扇区。它由三个部分组成，主引导程序(Bootloader)、 硬盘分区表DPT（Disk Partition table）和硬盘有效标志（55AA），其结构图如下所示：
</code></pre><p><img data-src="http://blog.chinaunix.net/attachment/201303/23/23069658_1364022306CqJH.gif" alt></p>
<pre><code> 磁盘分区表包含以下三部分：
 1）、Partition ID  （5：延申  82：Swap   83：Linux   8e：LVM     fd：RAID）
 2）、Partition起始磁柱
 3）、Partition的磁柱数量
通常情况下，诸如lilo、grub这些常见的引导程序都直接安装在MBR中。我们以grub为例来分析这个引导过程。
grub引导也分为两个阶段stage1阶段和stage2阶段(有些较新的grub又定义了stage1.5阶段)。
 1)、stage1：stage1是直接被写入到MBR中去的，这样机器一启动检测完硬件后，就将控制权交给了GRUB的代码。也就是上图所看到的前446个字节空间中存放的是stage1的代码。BIOS将stage1载入内存中0x7c00处并跳转执行。stage1（/stage1/start.S）的任务非常单纯，仅仅是将硬盘0头0道2扇区读入内存。而0头0道2扇区内容是源代码中的/stage2/start.S，编译后512字节，它是stage2或者stage1_5的入口。而此时，stage1是没有识别文件系统的能力的。如果感觉脑子有些晕了，那么下面的过程就直接跳过，去看stage2吧！
 【外传】定位硬盘的0头0道2扇区的过程：
  BIOS将stage1载入内存0x7c00处并执行，然后调用BIOS INIT13中断，将硬盘0头0道2扇区内容载入内存0x7000处，然后调用copy_buffer将其转移到内存0x8000处。在定位0头0道2扇区时通常有两种寻址方式：LBA和CHS。如果你是刨根问底儿型的爱好者，那么此时去找谷哥打听打听这两种方式的来龙去脉吧。
  2)、stage2：严格来说这里还应该再区分个stage1.5的，就一并把stage1.5放在这里一起介绍了，免得大家看得心里乱哄哄的。好的，我们继续说0头0到2扇区的/stage2/start.S文件，当它的内容被读入到内存之后，它的主要作用就是负责将stage2或stage1.5从硬盘读到内存中。如果是stage2，它将被载入到0x820处；如果是stage1.5，它将被载入到0x2200处。这里的stage2或者stage1_5不是/boot分区/boot/grub目录下的文件，因为这个时候grub还没有能力识别任何文件系统。
 ?  如果start.S加载stage1.5：stage1.5它存放在硬盘0头0道3扇区向后的位置，stage1_5作为stage1和stage2中间的桥梁，stage1_5有识别文件系统的能力，此后grub才有能力去访问/boot分区/boot/grub目录下的 stage2文件，将stage2载入内存并执行。
 ?  如果start.S加载stage2：同样，这个stage2也不是/boot分区/boot/grub目录下的stage2，这个时候start.S读取的是存放在/boot分区Boot Sector的stage2。这种情况下就有一个限制：因为start.S通过BIOS中断方式直接对硬盘寻址（而非通过访问具体的文件系统），其寻址范围有限，限制在8GB以内。因此这种情况需要将/boot分区分在硬盘8GB寻址空间之前。
 假如是情形2，我们将/boot/grub目录下的内容清空，依然能成功启动grub；假如是情形1，将/boot/grub目录下stage2删除后，则系统启动过程中grub会启动失败。
</code></pre><p>启动内核</p>
<pre><code>当stage2被载入内存执行时，它首先会去解析grub的配置文件/boot/grub/grub.conf，然后加载内核镜像到内存中，并将控制权转交给内核。而内核会立即初始化系统中各设备并做相关的配置工作，其中包括CPU、I/O、存储设备等。
</code></pre><p>关于Linux的设备驱动程序的加载，有一部分驱动程序直接被编译进内核镜像中，另一部分驱动程序则是以模块的形式放在initrd(ramdisk)中。<br>      Linux内核需要适应多种不同的硬件架构，但是将所有的硬件驱动编入内核又是不实际的，而且内核也不可能每新出一种硬件结构，就将该硬件的设备驱动写入内核。实际上Linux的内核镜像仅是包含了基本的硬件驱动，在系统安装过程中会检测系统硬件信息，根据安装信息和系统硬件信息将一部分设备驱动写入 initrd 。这样在以后启动系统时，一部分设备驱动就放在initrd中来加载。这里有必要给大家再多介绍一下initrd这个东东：<br>       initrd 的英文含义是 bootloader initialized RAM disk，就是由 boot loader 初始化的内存盘。在 linu2.6内核启动前，boot loader 会将存储介质中的 initrd 文件加载到内存，内核启动时会在访问真正的根文件系统前先访问该内存中的 initrd 文件系统。在 boot loader 配置了 initrd 的情况下，内核启动被分成了两个阶段，第一阶段先执行 initrd 文件系统中的init，完成加载驱动模块等任务，第二阶段才会执行真正的根文件系统中的 /sbin/init 进程。<br>      另外一个概念：initramfs<br>       initramfs 是在 kernel 2.5中引入的技术，实际上它的含义就是：在内核镜像中附加一个cpio包，这个cpio包中包含了一个小型的文件系统，当内核启动时，内核将这个 cpio包解开，并且将其中包含的文件系统释放到rootfs中，内核中的一部分初始化代码会放到这个文件系统中，作为用户层进程来执行。这样带来的明显的好处是精简了内核的初始化代码，而且使得内核的初始化过程更容易定制。<br>疑惑的是：我的内核是2.6.32-71.el6.i686版本，但在我的/boot分区下面却存在的是/boot/initramfs-2.6.32-71.el6.i686.img类型的文件，没搞明白，还望高人解惑。我只知道在2.6内核中支持两种格式的initrd，一种是2.4内核的文件系统镜像image-initrd，一种是cpio格式。接下来我们就来探究一下initramfs-2.6.32-71.el6.i686.img里到底放了那些东西。<br><img data-src="http://blog.chinaunix.net/attachment/201303/23/23069658_1364022354796s.gif" alt><br>    在tmp文件夹中解压initrd.img里的内容：<br><img data-src="http://blog.chinaunix.net/attachment/201303/23/23069658_1364022370Prdp.gif" alt></p>
<p>如果initrd.img文件的格式显示为“initrd.img:ISO 9660 CD-ROM filesystem data”，则可直接输入命令“mount -o loop initrd.img /mnt/test”进行挂载。<br>         通过上的分析和我们的验证，我们确实得到了这样的结论：<br>         grub的stage2将initrd加载到内存里，让后将其中的内容释放到内容中，内核便去执行initrd中的init脚本，这时内核将控制权交给了init文件处理。我们简单浏览一下init脚本的内容，发现它也主要是加载各种存储介质相关的设备驱动程序。当所需的驱动程序加载完后，会创建一个根设备，然后将根文件系统rootfs以只读的方式挂载。这一步结束后，释放未使用的内存，转换到真正的根文件系统上面去，同时运行/sbin/init程序，执行系统的1号进程。此后系统的控制权就全权交给/sbin/init进程了。<br>l  初始化系统<br>经过千辛万苦的跋涉，我们终于接近黎明的曙光了。接下来就是最后一步了：初始化系统。/sbin/init进程是系统其他所有进程的父进程，当它接管了系统的控制权先之后，它首先会去读取/etc/inittab文件来执行相应的脚本进行系统初始化，如设置键盘、字体，装载模块，设置网络等。主要包括以下工作：<br>1)、执行系统初始化脚本(/etc/rc.d/rc.sysinit)，对系统进行基本的配置，以读写方式挂载根文件系统及其它文件系统，到此系统算是基本运行起来了，后面需要进行运行级别的确定及相应服务的启动。rc.sysinit所做的事情(不同的Linux发行版，该文件可能有些差异)如下：<br>（1）获取网络环境与主机类型。首先会读取网络环境设置文件”/etc/sysconfig/network”，获取主机名称与默认网关等网络环境。<br>（2）测试与载入内存设备/proc及usb设备/sys。除了/proc外，系统会主动检测是否有usb设备，并主动加载usb驱动，尝试载入usb文件系统。<br>（3）决定是否启动SELinux。<br>（4）接口设备的检测与即插即用（pnp）参数的测试。<br>（5）用户自定义模块的加载。用户可以再”/etc/sysconfig/modules/<em>.modules”加入自定义的模块，此时会加载到系统中。<br>（6）加载核心的相关设置。按”/etc/sysctl.conf”这个文件的设置值配置功能。<br>（7）设置系统时间（clock）。<br>（8）设置终端的控制台的字形。<br>（9）设置raid及LVM等硬盘功能。<br>（10）以方式查看检验磁盘文件系统。<br>（11）进行磁盘配额quota的转换。<br>（12）重新以读取模式载入系统磁盘。<br>（13）启动quota功能。<br>（14）启动系统随机数设备（产生随机数功能）。<br>（15）清楚启动过程中的临时文件。<br>（16）将启动信息加载到”/var/log/dmesg”文件中。<br> 当/etc/rc.d/rc.sysinit执行完后，系统就可以顺利工作了，只是还需要启动系统所需要的各种服务，这样主机才可以提供相关的网络和主机功能，因此便会执行下面的脚本。<br>2)、执行/etc/rc.d/rc脚本。该文件定义了服务启动的顺序是先K后S，而具体的每个运行级别的服务状态是放在/etc/rc.d/rc</em>.d（<em>=0~6）目录下，所有的文件均是指向/etc/init.d下相应文件的符号链接。rc.sysinit通过分析/etc/inittab文件来确定系统的启动级别，然后才去执行/etc/rc.d/rc</em>.d下的文件。<br>/etc/init.d-&gt; /etc/rc.d/init.d<br>/etc/rc -&gt;/etc/rc.d/rc<br>/etc/rc<em>.d -&gt;/etc/rc.d/rc</em>.d<br>/etc/rc.local-&gt; /etc/rc.d/rc.local<br>/etc/rc.sysinit-&gt; /etc/rc.d/rc.sysinit<br>也就是说，/etc目录下的init.d、rc、rc<em>.d、rc.local和rc.sysinit均是指向/etc/rc.d目录下相应文件和文件夹的符号链接。我们以启动级别3为例来简要说明一下。<br>/etc/rc.d/rc3.d目录，该目录下的内容全部都是以 S 或 K 开头的链接文件，都链接到”/etc/rc.d/init.d”目录下的各种shell脚本。S表示的是启动时需要start的服务内容，K表示关机时需要关闭的服务内容。/etc/rc.d/rc</em>.d中的系统服务会在系统后台启动，如果要对某个运行级别中的服务进行更具体的定制，通过chkconfig命令来操作，或者通过setup、ntsys、system-config-services来进行定制。如果我们需要自己增加启动的内容，可以在init.d目录中增加相关的shell脚本，然后在rc*.d目录中建立链接文件指向该shell脚本。这些shell脚本的启动或结束顺序是由S或K字母后面的数字决定，数字越小的脚本越先执行。例如，/etc/rc.d/rc3.d /S01sysstat就比/etc/rc.d/rc3.d /S99local先执行。<br>3)、执行用户自定义引导程序/etc/rc.d/rc.local。其实当执行/etc/rc.d/rc3.d/S99local时，它就是在执行/etc/rc.d/rc.local。S99local是指向rc.local的符号链接。就是一般来说，自定义的程序不需要执行上面所说的繁琐的建立shell增加链接文件的步骤，只需要将命令放在rc.local里面就可以了，这个shell脚本就是保留给用户自定义启动内容的。<br>4)、完成了系统所有的启动任务后，linux会启动终端或X-Window来等待用户登录。tty1,tty2,tty3…这表示在运行等级1，2，3，4的时候，都会执行”/sbin/mingetty”，而且执行了6个，所以linux会有6个纯文本终端，mingetty就是启动终端的命令。<br>除了这6个之外还会执行”/etc/X11/prefdm-nodaemon”这个主要启动X-Window<br>至此，系统就启动完毕了。以上分析不到的地方还请各位大虾不吝指正。<br>关于Linux的其他分析内容下次再继续写。<br>最后附上一张非常完整的系统启动流程图，适合各个水平阶段的读者。<br><img data-src="http://blog.chinaunix.net/attachment/201303/23/23069658_13640223868sSU.gif" alt></p>
<p>参考文献：<br><a href="http://www.cnblogs.com/scnutiger/archive/2009/09/30/1576795.html" target="_blank" rel="noopener">http://www.cnblogs.com/scnutiger/archive/2009/09/30/1576795.html</a><br><a href="http://www.it.com.cn/f/edu/0411/24/51090.htm" target="_blank" rel="noopener">http://www.it.com.cn/f/edu/0411/24/51090.htm</a><br><a href="http://bbs.chinaunix.net/thread-2046548-1-1.html" target="_blank" rel="noopener">http://bbs.chinaunix.net/thread-2046548-1-1.html</a><br><a href="http://space.itpub.net/8111049/viewspace-680043" target="_blank" rel="noopener">http://space.itpub.net/8111049/viewspace-680043</a><br><a href="http://dongdiy.blog.51cto.com/1908223/366909" target="_blank" rel="noopener">http://dongdiy.blog.51cto.com/1908223/366909</a><br><a href="http://icarusli.iteye.com/blog/625755" target="_blank" rel="noopener">http://icarusli.iteye.com/blog/625755</a><br><a href="http://www.54sa.net/?p=549" target="_blank" rel="noopener">http://www.54sa.net/?p=549</a><br><a href="http://roclinux.cn/?p=1301" target="_blank" rel="noopener">http://roclinux.cn/?p=1301</a></p>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/Technology/IPCreator/Technology/Program/Tools/Linux/the-basic-concepts-of-linux/" rel="bookmark">The Basic Concepts of Linux</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/Technology/IPCreator/Technology/Program/Tools/Linux/the-basic-concepts-of-linux-server/" rel="bookmark">The Basic Concepts of Linux Server</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/Program/IPCreator/Technology/Program/Tools/Linux/the-anatomy-of-file-system/" rel="bookmark">File System of Linux</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/Program/IPCreator/Technology/Program/Computer/Operating System/" rel="bookmark">Operating System</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/Program/IPCreator/Technology/Program/Java/Code-The Hidden Language of Computer Hardware and Software/" rel="bookmark">Code-The Hidden Language of Computer Hardware and Software</a></div>
    </li>
  </ul>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Basic-Concept/" rel="tag"><i class="fa fa-tag"></i> Basic Concept</a>
              <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Program/IPCreator/Technology/Program/Tools/Linux/the-anatomy-of-file-system/" rel="prev" title="File System of Linux">
      <i class="fa fa-chevron-left"></i> File System of Linux
    </a></div>
      <div class="post-nav-item">
    <a href="/Program/IPCreator/Technology/Program/Tools/Linux/the-anatomy-of-network-programming/" rel="next" title="Linux Network Program">
      Linux Network Program <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Internet-IP-protocols"><span class="nav-number">1.</span> <span class="nav-text">Internet (IP) protocols</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-number">2.</span> <span class="nav-text">Success!</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#小结："><span class="nav-number">2.0.1.</span> <span class="nav-text">小结：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux系统启动过程分析"><span class="nav-number">2.1.</span> <span class="nav-text">Linux系统启动过程分析 </span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="IPCreator"
      src="/img/content/Kick-Off.jpg">
  <p class="site-author-name" itemprop="name">IPCreator</p>
  <div class="site-description" itemprop="description">Life is a journey.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">1538</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1451</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → /atom.xml"><i class="rss fa-fw"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://blog.163.com/zhuxuanlv@126/" title="http://blog.163.com/zhuxuanlv@126/" rel="noopener" target="_blank">163 Blog</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">IPCreator</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">27.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">414:44</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>



  



  <script>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : 11184,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  <script src="/js/local-search.js"></script>








<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://hazyman.com/Program/IPCreator/Technology/Program/Tools/Linux/start-up-of-linux/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'C75jI23HEPhTehiFhCvUSbJY-gzGzoHsz',
      appKey     : 'qy3Id9srq8HBxwKg3CVSdNNq',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
